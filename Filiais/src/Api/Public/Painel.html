<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Filiais</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>
    <div class="container">
        <h1>Gerenciador de Filiais VitalMob</h1>

        <!-- Botão para abrir o modal de cadastro de filial -->
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#cadastroModal">
            Adicionar Nova Filial
        </button>

        <!-- Modal de Cadastro de Filial -->
        <div class="modal fade" id="cadastroModal" tabindex="-1" role="dialog" aria-labelledby="cadastroModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="cadastroModalLabel">Adicionar Nova Filial</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <button type="button" class="btn btn-primary" id="preencherComInfoAleatorias">Preencher com
                            Informações Aleatórias</button>
                        <div class="overflow-auto" style="height: 300px;">
                            <h1>Formulário de Cadastro de Filial</h1>
                            <form id="formulario_add_filiais" action="/cadastrofiliais" method="post">
                                <!-- Nome da Filial -->
                                <div class="form-group">
                                    <label for="nome">Nome da Filial:</label>
                                    <input type="text" class="form-control" id="nome" name="nome"
                                        placeholder="Digite o nome da filial">
                                </div>

                                <!-- Data de Criação -->
                                <div class="form-group">
                                    <label for="dataCriacao">Data de Criação:</label>
                                    <input type="date" class="form-control" id="dataCriacao" name="dataCriacao">
                                </div>

                                <!-- Mapa (Latitude e Longitude) -->
                                <div class="form-group">
                                    <label for="latitude">Latitude:</label>
                                    <input type="text" class="form-control" id="latitude"
                                        placeholder="Digite a latitude" name="latitude">
                                </div>
                                <div class="form-group">
                                    <label for="latitudeDelta">LatitudeDelta:</label>
                                    <input type="text" class="form-control" id="latitudeDelta"
                                        placeholder="Digite a latitude" name="latitudeDelta">
                                </div>
                                <div class="form-group">
                                    <label for="longitude">Longitude:</label>
                                    <input type="text" class="form-control" id="longitude"
                                        placeholder="Digite a longitude" name="longitude">
                                </div>
                                <div class="form-group">
                                    <label for="longitudeDelta">LongitudeDelta:</label>
                                    <input type="text" class="form-control" id="longitudeDelta"
                                        placeholder="Digite a longitude" name="longitudeDelta">
                                </div>

                                <!-- Informações de Contato -->
                                <div class="form-group">
                                    <label for="email">E-mail de Contato:</label>
                                    <input type="email" class="form-control" id="email"
                                        placeholder="Digite o e-mail de contato" name="email">
                                </div>
                                <div class="form-group">
                                    <label for="telefone">Telefone de Contato:</label>
                                    <input type="text" class="form-control" id="telefone"
                                        placeholder="Digite o telefone de contato" name="telefone">
                                </div>
                                <div class="form-group">
                                    <label for="linkContato">Link de Contato:</label>
                                    <input type="text" class="form-control" id="linkContato"
                                        placeholder="Digite o link de contato" name="linkContato">
                                </div>

                                <!-- Site e Imagem -->
                                <div class="form-group">
                                    <label for="site">Site:</label>
                                    <input type="text" class="form-control" id="site"
                                        placeholder="Digite o site da filial" name="site">
                                </div>
                                <div class="form-group">
                                    <label for="imagem">URL da Imagem 1:</label>
                                    <input type="text" class="form-control" id="imagem1" name="imagem1"
                                        placeholder="Digite a URL da imagem" name="imagem">
                                </div>
                                <div class="form-group">
                                    <label for="imagem">URL da Imagem 2:</label>
                                    <input type="text" class="form-control" id="imagem2" name="imagem2"
                                        placeholder="Digite a URL da imagem" name="imagem">
                                </div>
                                <div class="form-group">
                                    <label for="imagem">URL da Imagem 3:</label>
                                    <input type="text" class="form-control" id="imagem3" name="imagem3"
                                        placeholder="Digite a URL da imagem" name="imagem">
                                </div>



                                <!-- Horário de Funcionamento -->
                                <h4>Horário de Funcionamento:</h4>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="segunda" name="segunda">
                                    <label class="form-check-label" for="segunda">Segunda-feira</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="terca" id="terca">
                                    <label class="form-check-label" for="segunda">Terça-feira</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="quarta" name="quarta">
                                    <label class="form-check-label" for="segunda">Quarta-feira</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="quinta" name="quinta">
                                    <label class="form-check-label" for="segunda">Quinta-feira</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="sexta" name="sexta">
                                    <label class="form-check-label" for="segunda">Sexta-feira</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <label class="form-check-label" for="horaincio">Das</label>
                                    <input class="form-check-input" type="time" id="horaincio" name="horaincio">
                                    <label class="form-check-label" for="horafinal"> Até </label>
                                    <input class="form-check-input" type="time" id="horafinal" name="horafinal">
                                </div>


                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                        <button type="submit" class="btn btn-primary">Cadastrar Filial</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Botão para abrir o modal de visualização de filiais -->
        <button type="button" class="btn btn-success" data-toggle="modal" data-target="#visualizacaoModal">
            Vizualizar Filiais
        </button>

        <!-- Modal de Visualização de Filiais Cadastradas -->
        <div class="modal fade" id="visualizacaoModal" tabindex="-1" role="dialog"
            aria-labelledby="visualizacaoModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="visualizacaoModalLabel">Cadastrar Filiais</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="overflow-auto" style="height: 300px;">
                            <div class="overflow-auto" style="height: 300px;" id="bodyGetApi">

                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Botão para abrir o modal de exclusão de filiais -->
        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#exclusaoModal">
            Apagar Filiais
        </button>

        <!-- Modal de confirmação de exclusão -->
        <div class="modal fade" id="exclusaoModal" tabindex="-1" role="dialog" aria-labelledby="exclusaoModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exclusaoModalLabel">Confirmação de Exclusão</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="overflow-auto" style="height: 300px;" id="bodyGetApiDelete">

                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-danger" id="confirmarExclusao">Confirmar Exclusão</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        const formulario_add_filiais = document.getElementById("formulario_add_filiais");

        formulario_add_filiais.addEventListener('submit', (e) => {
            // Verifique se os campos obrigatórios foram preenchidos.
            const nome = formulario_add_filiais.nome.value;
            const dataCriacao = formulario_add_filiais.dataCriacao.value;
            const latitude = formulario_add_filiais.latitude.value;
            const longitude = formulario_add_filiais.longitude.value;
            const email = formulario_add_filiais.email.value;
            const telefone = formulario_add_filiais.telefone.value;
            const latitudeDelta = formulario_add_filiais.latitudeDelta.value;
            const longitudeDelta = formulario_add_filiais.longitudeDelta.value;
            const LinkContato = formulario_add_filiais.linkContato.value
            const imagem1 = formulario_add_filiais.imagem1.value
            const imagem2 = formulario_add_filiais.imagem2.value
            const imagem3 = formulario_add_filiais.imagem3.value
            const horaincio = formulario_add_filiais.horaincio.value
            const horafinal = formulario_add_filiais.horafinal.value


            if (!nome || !dataCriacao || !latitude || !longitude || !email || !telefone || !latitudeDelta || !longitudeDelta || !linkContato || !imagem1 || !imagem2 || !imagem3 || !horafinal || !horaincio) {
                alert("Por favor, preencha todos os campos obrigatórios.");
                e.preventDefault();
                return;
            }

            // Verifique se a latitude, a longitude e seus deltas são números válidos.
            if (isNaN(parseFloat(latitude)) || isNaN(parseFloat(longitude)) || isNaN(parseFloat(latitudeDelta)) || isNaN(parseFloat(longitudeDelta))) {
                alert("Latitude, Longitude, Latitude Delta e Longitude Delta devem ser números válidos.");
                e.preventDefault();
                return;
            }

            // Verifique se o email é válido (pode ser uma validação mais robusta).
            if (!isValidEmail(email)) {
                alert("Digite um endereço de e-mail válido.");
                e.preventDefault();
                return;
            }

            // Outras verificações e manipulações de dados podem ser adicionadas aqui.

            // Continue com o envio do formulário se todas as verificações passarem.
        });

        function isValidEmail(email) {
            // Implemente sua própria validação de e-mail aqui, se necessário.
            // Isso é apenas um exemplo simples.
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Função para gerar informações aleatórias
        function gerarInfoAleatoria() {
            // Gere informações aleatórias
            const numeroTelefone = `(${Math.floor(Math.random() * 900) + 100}) ${Math.floor(Math.random() * 9000) + 1000}-${Math.floor(Math.random() * 9000) + 1000}`;
            const nomesAleatorios = ["Filial-A", "Filial-B", "Filial-C", "Filial-E", "Filial-F", "Filial-G"];
            const nomeAleatorio = nomesAleatorios[Math.floor(Math.random() * nomesAleatorios.length)];
            const dataCriacaoAleatoria = "2023-09-25"; // Data fictícia
            const latitudeAleatoria = Math.random() * (90 - (-90)) + (-90); // Latitude entre -90 e 90
            const longitudeAleatoria = Math.random() * (180 - (-180)) + (-180); // Longitude entre -180 e 180
            const emailAleatorio = "email@example.com"; // E-mail fictício
            const telefoneAleatorio = "123-456-7890"; // Número de telefone fictício
            const latitudeDeltaAleatoria = Math.random() * (10 - 1) + 1; // Valor aleatório entre 1 e 10
            const longitudeDeltaAleatoria = Math.random() * (10 - 1) + 1; // Valor aleatório entre 1 e 10
            const siteAleatorio = "http://www.exemplo.com"; // Site fictício
            const imagemAleatoria = "https://i1.wp.com/www.dci.com.br/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/09/perfil-sem-foto-1024x655.jpg.webp"; // URL da imagem fictícia
            const diasDaSemana = ["segunda", "terca", "quarta", "quinta", "sexta"];
            const randomHours = Math.floor(Math.random() * 24);    // Valor entre 0 e 23
            const randomMinutes = Math.floor(Math.random() * 60);  // Valor entre 0 e 59
            // Formate os valores para ter dois dígitos (por exemplo, 5 -> "05")
            const formattedHours = String(randomHours).padStart(2, '0');
            const formattedMinutes = String(randomMinutes).padStart(2, '0');
            const randomTimeInit = `${formattedHours}:${formattedMinutes}`;
            const randomTimeFinal = `${formattedHours}:${formattedMinutes}`;
            // Preencha os campos com as informações aleatórias
            document.getElementById("nome").value = nomeAleatorio;
            document.getElementById("dataCriacao").value = dataCriacaoAleatoria;
            document.getElementById("latitude").value = latitudeAleatoria.toFixed(6); // Ajuste para 6 casas decimais
            document.getElementById("longitude").value = longitudeAleatoria.toFixed(6); // Ajuste para 6 casas decimais
            document.getElementById("email").value = emailAleatorio;
            document.getElementById("telefone").value = telefoneAleatorio;
            document.getElementById("latitudeDelta").value = latitudeDeltaAleatoria.toFixed(2); // Ajuste para 2 casas decimais
            document.getElementById("longitudeDelta").value = longitudeDeltaAleatoria.toFixed(2); // Ajuste para 2 casas decimais
            document.getElementById("site").value = siteAleatorio;
            document.getElementById("telefone").value = numeroTelefone
            document.getElementById("linkContato").value = numeroTelefone
            document.getElementById("imagem1").value = imagemAleatoria;
            document.getElementById("imagem2").value = imagemAleatoria;
            document.getElementById("imagem3").value = imagemAleatoria;
            document.getElementById("horaincio").value = randomTimeInit;
            document.getElementById("horafinal").value = randomTimeFinal;
            // Preencha os checkboxes de dias da semana aleatoriamente
            for (const dia of diasDaSemana) {
                document.getElementById(dia).checked = Math.random() < 0.5; // 50% de chance de estar marcado
            }
        }
        // Adicione um evento de clique ao botão "Preencher com Informações Aleatórias"
        document.getElementById('preencherComInfoAleatorias').addEventListener('click', gerarInfoAleatoria);

        const url = window.location.href;
        const novaURL = url.replace("/Api", "/Api/dados");

        fetch(novaURL)
            .then((response) => {
                if (!response.ok) {
                    throw new Error('Erro na requisição HTTP');
                }
                return response.json();
            })
            .then((data) => {

                // Faça algo com os dados JSON recebidos
                const container = document.getElementById("bodyGetApi");


                data.map((item) => {
                    const nome = item.dadosFiliais.nome;
                    const data_criacao = item.dadosFiliais.dataCriacao;
                    const horario_funcionamento = item.horario_funcionamento[0];
                    const informacoes_contato = item.informacoes_contato[0];
                    const telefone = informacoes_contato.telefone;
                    const linkContato = informacoes_contato.link_contato;
                    const site = informacoes_contato.site;
                    const email = informacoes_contato.email;
                    const mapa = item.mapa[0];
                    const longitude = mapa.longitude;
                    const latitude = mapa.latitude;
                    const imagens = item.imagens[0];
                    const imagem1 = imagens.img_1
                    const imagem2 = imagens.img_3;
                    const imagem3 = imagens.img_3;

                    // Criar elementos HTML para o card
                    const card = document.createElement("div");
                    card.classList.add("card", "mb-4");

                    // Conteúdo do card
                    card.innerHTML = `
                <div class="card-body">
                    <h5 class="card-title">${nome}</h5>
                    <p class="card-text">Data de Criação: ${data_criacao}</p>
                    <p class="card-text">Horário de Funcionamento: ${horario_funcionamento}</p>
                    <p class="card-text">Telefone: ${telefone}</p>
                    <p class="card-text">Link de Contato: <a href='${linkContato}'>${telefone}</a></p>
                    <p class="card-text">Email: ${email}</p>
                    <p class="card-text">Site: ${site}</p>
                    <p class="card-text">Longitude: ${longitude}</p>
                    <p class="card-text">Latitude: ${latitude}</p>
                </div>
                <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img src="${imagem1}" class="d-block w-100" alt="Image 1">
                        </div>
                        <div class="carousel-item">
                            <img src="${imagem2}" class="d-block w-100" alt="Image 2">
                        </div>
                        <div class="carousel-item">
                            <img src="${imagem3}" class="d-block w-100" alt="Image 3">
                        </div>
                    </div>
                    <a class="carousel-control-prev" href="#carouselExample" role="button" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExample" role="button" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </a>
                </div>
            `;

                    // Adicionar o card ao container
                    container.appendChild(card);
                });


            })
            .catch((error) => {
                console.error('Erro:', error);
            });


        const urlDoc = url.replace("/Api", "/Doc");

        fetch(urlDoc)
            .then((response) => {
                if (!response.ok) {
                    throw new Error('Erro na requisição HTTP');
                }
                return response.json();
            })
            .then((data) => {
                const container = document.getElementById("bodyGetApiDelete");
                data.map(item => {
                    const card = document.createElement("div");
                    card.classList.add("card", "mb-4");
                    const id = item.id

                    // Conteúdo do card
                    card.innerHTML = `
                <div class="card-body">
                    <h5 class="card-title">${item.nome}</h5>
                    <p class="card-text">Data de Criação: ${item.data_criacao}</p>
                    <button type="button" class="btn btn-danger" onclick="deleteItem('${id}')">Excluir : ${id}</button>
                </div>
                    `;

                    container.appendChild(card);


                })

            })
            .catch((error) => {
                console.error('Erro:', error);
            });

        function deleteItem(id) {
            // Use o prompt do Windows para obter a confirmação do usuário
            const userConfirmation = window.prompt(` Digite " /${id} " para confirmar.`);

            // Verifique a resposta do usuário
            if (userConfirmation === `/${id}`) {
                // O usuário confirmou, prosseguir com a exclusão
                fetch(`/delete/${id}`, {
                    method: 'DELETE', // Especifica o método DELETE
                })
                    .then((response) => {
                        if (response.ok) {
                            // Documento apagado com sucesso
                            alert(`Documento com ID ${id} apagado com sucesso.`);
                            // Atualize a interface do usuário ou faça qualquer outra ação necessária aqui
                        } else {
                            // Houve um erro ao apagar o documento
                            alert(`Erro ao apagar o documento com ID ${id}.`);
                        }
                    })
                    .catch((error) => {
                        console.error('Erro ao fazer a requisição DELETE:', error);
                    });
            } else {
                // O usuário cancelou a exclusão
                alert('Exclusão cancelada.');
            }
        }

    </script>



</body>

</html>